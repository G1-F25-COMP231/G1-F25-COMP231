{% extends "advisor.html" %}

{% block content %}

<h1 class="page-title">Client Financial Summary</h1>

<!-- ðŸ”¥ OVEREPENDING BANNER (NEW) -->
<div id="overspendingBanner" style="
  display:none;
  background:#ff5b5b;
  padding:14px;
  color:white;
  border-radius:10px;
  margin-bottom:20px;
  text-align:center;
  font-weight:600;
  box-shadow:0 0 15px rgba(255,0,0,0.2);
">
  Overspending detected.
</div>

<!-- TOP CONTROLS: client + time range -->
<div class="summary-controls">
  <label for="clientSelect">Client:</label>
  <select id="clientSelect">
    <option value="">Select a clientâ€¦</option>
  </select>

  <button id="loadSummaryBtn" class="btn" style="margin-left:8px;">
    Load Summary
  </button>

  <div style="flex:1;"></div>

  <label for="timeFilter">Time Range:</label>
  <select id="timeFilter">
    <option value="month">This Month</option>
    <option value="quarter">This Quarter</option>
    <option value="year">This Year</option>
  </select>
</div>

<div class="summary-grid">

  <!-- LINE CHART -->
  <div class="summary-card">
    <h2>Income vs Expenses</h2>
    <div id="lineChartNoData" style="display:none; color:#b8c4d1; text-align:center; padding:40px 0;">
      No data available.
    </div>
    <canvas id="lineChart"></canvas>
  </div>

  <!-- PIE CHART -->
  <div class="summary-card">
    <h2>Category Breakdown</h2>
    <div id="pieChartNoData" style="display:none; color:#b8c4d1; text-align:center; padding:40px 0;">
      No data available.
    </div>
    <canvas id="pieChart"></canvas>
  </div>

</div>

<!-- ðŸ”¥ ALERT SUMMARY MODULE (NEW) -->
<div class="summary-card" style="margin-top:24px;">
  <h2>Alert Summary</h2>

  <!-- ðŸ”¥ Budget limit display + access button (ADDED) -->
  <div class="budget-limit-controls"
       style="font-size:0.9rem; display:flex; align-items:center; gap:8px; margin-bottom:10px;">
    <span>
      Budget Limit:
      <span id="alertBudgetLimitText">$0.00</span>
    </span>

    <button id="budgetAccessBtn"
            class="btn"
            style="padding:4px 10px; font-size:0.85rem;">
      Request Access
    </button>
  </div>

  <!-- ðŸ”¥ Inline edit form for budget limit (ADDED, hidden by default) -->
  <div id="budgetEditForm"
       style="display:none; margin-bottom:10px; gap:8px; align-items:center;">
    <label for="budgetLimitInput" style="font-size:0.85rem;">New Limit:</label>
    <input type="number"
           id="budgetLimitInput"
           min="0"
           step="0.01"
           style="max-width:140px; padding:6px 8px; border-radius:6px;
                  border:1px solid #233554; background:#0b1220; color:#e2e8f0;">
    <button id="budgetSaveBtn"
            class="btn"
            style="padding:4px 10px; font-size:0.85rem;">
      Save
    </button>
    <button id="budgetCancelBtn"
            type="button"
            class="btn"
            style="padding:4px 10px; font-size:0.85rem; background:#1f2937;">
      Cancel
    </button>
  </div>

  <table class="advisor-table">
    <thead>
      <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Spent</th>
        <th>Budget Limit</th>
      </tr>
    </thead>
    <tbody id="alertSummaryTableBody">
      <tr>
        <td colspan="4" style="color:#b8c4d1; text-align:center;">
          No alerts yet.
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- TRANSACTIONS LIST -->
<div class="summary-card" style="margin-top:24px;">
  <h2>Client Transactions</h2>
  <table class="advisor-table">
    <thead>
      <tr>
        <th>Date</th>
        <th>Merchant</th>
        <th>Category</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody id="clientTxTableBody">
      <tr>
        <td colspan="4" style="text-align:center; color:#b8c4d1;">
          Select a client to view transactions.
        </td>
      </tr>
    </tbody>
  </table>
</div>

{% endblock %}

{% block extra_scripts %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/static/advisor_summary.js"></script>
{% endblock %}
