{% extends "user_shell.html" %}
{% set active_page = "entry" %}

{% block title %}Add Entry — BudgetMind AI{% endblock %}

{% block head_extras %}
  <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
{% endblock %}

{% block content %}
  <!-- Topbar -->
  <header class="topbar">
    <button class="icon-btn" id="toggleSidebar">☰</button>
    <div class="search">
      <input type="text" placeholder="Search transactions..." />
    </div>
  </header>

  <!-- Content -->
  <section class="content">
    <h1>Add New Entry</h1>

    <div class="card entry-card">
      <form id="entryForm" class="entry-form">
        <div class="form-group">
          <label for="type">Transaction Type</label>
          <select name="type" id="type" required>
            <option value="Income">Income</option>
            <option value="Expense">Expense</option>
          </select>
        </div>

        <div class="form-group">
          <label for="category">Category</label>
          <input type="text" name="category" id="category" placeholder="e.g. Dining, Bills, Travel" required>
        </div>

        <div class="form-group">
          <label for="amount">Amount ($)</label>
          <input type="number" name="amount" id="amount" step="0.01" required>
        </div>

        <div class="form-actions">
          <button class="btn" type="submit">Add Entry</button>
        </div>
      </form>

      <!-- Success message -->
      <div id="successAlert" class="alert" style="display:none;">✅ Entry added successfully!</div>
    </div>
  </section>
{% endblock %}

{% block scripts %}
  <script>
  document.getElementById("entryForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const form = e.target;
    const data = new FormData(form);
    const payload = new URLSearchParams(data);

    try {
      const res = await fetch("/entry", {
        method: "POST",
        body: payload
      });
      const result = await res.json();

      if (result.ok) {
        const alertBox = document.getElementById("successAlert");
        alertBox.style.display = "block";
        form.reset();

        // Hide alert after 2 seconds
        setTimeout(() => {
          alertBox.style.display = "none";
        }, 2000);
      } else {
        alert("⚠️ " + (result.message || "Something went wrong."));
      }
    } catch (err) {
      alert("❌ Network error. Please try again.");
      console.error(err);
    }
  });
  </script>
{% endblock %}
