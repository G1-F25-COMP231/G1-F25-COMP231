{% extends "user_shell.html" %}
{% set active_page = "dashboard" %}

{% block title %}BudgetMind AI ‚Äî Dashboard{% endblock %}

{% block head_extras %}
  <link rel="stylesheet" href="/static/dashboard.css" />
{% endblock %}

{% block content %}
  <!-- Top Bar -->
  <header class="topbar">
    <div class="topbar-left">
      <button class="icon-btn" id="toggleSidebar">‚ò∞</button>

      <button class="icon-btn notif-btn" id="notificationsBtn">
        üîî
        <span id="notificationsBadge" class="notif-badge hidden"></span>
      </button>
    </div>

    <div class="search">
      <input type="text" placeholder="Search transactions‚Ä¶" />
    </div>
  </header>

  <!-- PAGE CONTENT -->
  <section class="content">

    <!-- ROW 1 -->
    <div class="grid grid-3">

      <div class="card stat">
        <div class="stat__label">Total Balance</div>
        <div class="stat__value" id="totalBalance">$0.00</div>
        <div class="spark">
          <svg viewBox="0 0 100 30"><path d="M0,20 L15,12 L30,18 L45,8 L60,14 L75,10 L90,16 100,9"/></svg>
        </div>
      </div>

      <div class="card stat">
        <div class="stat__label">Monthly Spending</div>
        <div class="stat__value" id="monthlySpending">$0.00</div>
        <div class="hint" id="monthlySpendingHint">vs. budget $0.00</div>
        <div class="progress"><div class="progress__bar" id="monthlySpendingProgress"></div></div>
      </div>

      <div class="card stat">
        <div class="stat__label">Savings Goal</div>
        <div class="stat__value" id="savingsGoalText">$0.00 / $10,000</div>
        <div class="hint" id="savingsGoalHint">Based on your linked account balance.</div>
        <div class="progress"><div class="progress__bar alt" id="savingsGoalProgress"></div></div>
      </div>

    </div>

    <!-- ROW 2 -->
    <div class="grid grid-2">

      <div class="card chart">
        <div class="card__title">Income vs. Expenses</div>
        <div class="bars" id="barChart"></div>
      </div>

      <div class="card chart">
        <div class="card__title" style="display:flex; justify-content:space-between; align-items:center;">
          <span>Category Spend</span>

          <select id="pieFilter"
            style="padding:6px 10px; border-radius:8px; background:#0b132b; color:white; border:1px solid #1b263b;">
            <option value="all">All</option>
            <option value="thisMonth">This Month</option>
            <option value="lastMonth">Last Month</option>
            <option value="income">Income Only</option>
            <option value="expense">Expense Only</option>
          </select>
        </div>

        <canvas id="dashboardCategoryChart"></canvas>
      </div>

    </div>

    <!-- ROW 3 -->
    <div class="grid grid-2">

      <!-- AI Insights -->
      <div class="card ai">
        <div class="card__title">AI Insights</div>
        <ul class="ai__list" id="aiInsights">
          <li>üîç Loading insights‚Ä¶</li>
        </ul>
        <div class="ai__actions">
          <button class="btn" id="refreshAI">Refresh tips</button>
          <button class="btn ghost" id="openChatBtn">üí¨ Open AI Chat</button>
        </div>
      </div>

      <!-- Recent Transactions -->
      <div class="card table">
        <div class="card__title">Recent Transactions</div>
        <table>
          <thead>
            <tr><th>Date</th><th>Merchant</th><th>Category</th><th>Amount</th></tr>
          </thead>
          <tbody id="txTable"></tbody>
        </table>
        <div class="table__footer">
          <a class="link" href="/transaction-details.html">View all</a>
        </div>
      </div>

      <!-- Advisor Notes -->
      <div class="card ai">
        <div class="card__title">Advisor Notes</div>

        <div id="advisorNotesView" class="advisor-notes-view">
          <p class="placeholder">Loading advisor notes‚Ä¶</p>
        </div>

        <div class="ai__actions">
          <button class="btn ghost" disabled style="opacity:0.6; cursor:not-allowed;">
            üîí Read-Only
          </button>
        </div>
      </div>

    </div> <!-- END GRID -->

  </section> <!-- END CONTENT -->

  <!-- AI Chat Modal -->
  <div id="aiChatModal" class="chat-modal hidden">
    <div class="chat-header">
      <h3>üí¨ BudgetMind AI Chat</h3>
      <button id="closeChat" class="close-btn">‚úñ</button>
    </div>

    <div id="chatMessages" class="chat-messages"></div>

    <form id="chatForm" class="chat-form">
      <input type="text" id="chatInput" placeholder="Ask BudgetMind AI something‚Ä¶" required />
      <button type="submit" class="btn">Send</button>
    </form>
  </div>

  <!-- Notifications Panel -->
  <div id="notificationsPanel" class="notif-panel hidden">
    <div class="notif-header">
      <span>Notifications</span>
      <button id="closeNotifications" class="icon-btn small">&times;</button>
    </div>
    <div id="notificationsList" class="notif-list">
      <p class="notif-empty">No new requests.</p>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="/static/dashboard.js"></script>
{% endblock %}
